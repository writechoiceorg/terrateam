---
title: Centralized Configuration
description: Configuration defaults and overrides can be specified in a central repository.
---

import MermaidDiagram from '../../../components/MermaidDiagram.astro';

Terrateam supports specifying defaults, overrides, and repository configurations in a central repository. This Centralized Configuration allows for centralized management, reducing the need for repetitive configurations across multiple repositories.

## Configuration Files

The configuration structure follows the same format as your repository's [`.terrateam/config.yml`](/configuration-reference/), but can be split across multiple files for different purposes:

1. **Defaults**: Base configuration that can be overridden by individual repositories
2. **Overrides**: Configuration that takes precedence over repository settings
3. **Full Configuration**: Complete configuration that replaces all other settings

These files are stored in a dedicated `terrateam` repository and are processed in a specific order:

| Name | Repository | Branch | Path | Purpose |
|--- |--- |--- |--- |--- |
| `global_defaults`| `terrateam` | Default | `config/defaults.yml` | Base configuration for all repositories |
| `global_overrides` | `terrateam` | Default | `config/overrides.yml` | Organization-wide settings that override repository configs |
| `repo_defaults` | `terrateam` | Default | `config/$repository_name/defaults.yml` | Repository-specific base settings |
| `repo_overrides` | `terrateam` | Default | `config/$repository_name/overrides.yml` | Repository-specific enforced settings |
| `repo_forced_config` | `terrateam` | Default | `config/$repository_name/config.yml` | Complete configuration that replaces all other settings |
| `repo_default_config` | Target repository | Default | `.terrateam/config.yml` | Repository's own configuration |
| `repo_config` | Target repository | Feature | `.terrateam/config.yml` | Pull request branch configuration |

:::note[Branch Context]
- **Default branch** refers to your repository's main branch (usually `main` or `master`)
- **Feature branch** refers to any branch where changes are being made (typically pull request branches)
:::

## Configuration Merging Process

<MermaidDiagram chart={`
flowchart TD
    subgraph Central ["Centralized Config (terrateam repo)"]
        A[global_defaults] --> B{repo_forced_config exists?}
        B -->|Yes| C[Direct Merge]
        B -->|No| D[Standard Merge]
        
        E[repo_defaults] --> D
        F[global_overrides] --> D
        G[repo_overrides] --> D
    end

    subgraph Repo ["Repository Config"]
        H[repo_default_config] --> D
        I[repo_config] --> J[Feature Branch Config]
    end

    D --> K[Default Branch Config]
    K --> J

`} />

### Standard Merging Process

1. **Default Branch Configuration**
   - Starts with `global_defaults`
   - Applies `repo_defaults`
   - Applies `global_overrides`
   - Applies `repo_overrides`
   - Finally applies repository's `.terrateam/config.yml`

2. **Feature Branch Configuration**
   - Uses the same process as default branch
   - Additionally applies any changes from the pull request's `.terrateam/config.yml`
   - Certain sections (`access_control`, `apply_requirements`, `destination_branches`) are always taken from the default branch configuration for security

### Forced Configuration

When `repo_forced_config` exists:
- Only `global_defaults` and `repo_forced_config` are used
- All other configuration files are ignored
- This provides a way to completely control a repository's configuration from the central repository

:::note[Optional Files]
Most configuration files are optional. The minimum required is either:
- A `.terrateam/config.yml` in your repository, or
- `global_defaults` in the central repository
:::

## Use Cases
### Disable Terrateam by Default
When transitioning to Terrateam, it may be beneficial to install the Terrateam GitHub application for an entire organization and all of your repositories. This approach allows teams to migrate to Terrateam at their own pace. However, Terrateam will begin acting on any changes to these repositories by default. To disable Terrateam by default, specify the following `global_defaults` configuration:

```yaml
enabled: false
```

As teams transition to Terrateam, they can enable it by specifying `enabled: true` in the repository configuration.

### Enforce Strict Set Of Workflows
Disable repositories from specitying their own workflows section.

Specify the following configuration in your `global_overrides`:

```yaml
workflows:
    - tag_query: ""
      plan:
          - type: init
          - type: plan
      apply:
          - type: init
          - type: apply
```

If specific repositories have workflows they require, they can be specified in the `repo_overrides` configuration.

### Restricting Apply Operations to Specific Teams
Ensure that only the SRE team can perform apply operations, while everyone can plan.

Specify the following configuration in your `global_overrides`:

```yaml
access_control:
  enabled: true
  policies:
    - tag_query: ""
      plan: ['*']
      apply: ['team:sre']
```

### Requiring Super Approval for Production Changes
Changes to the production environment require super approval from the SRE team, while other environments can be managed by developers.

Specify the following configuration in your `global_overrides`:

```yaml
access_control:
  enabled: true
  policies:
    - tag_query: "dir:production"
      apply_with_superapproval: ['*']
      superapproval: ['team:sre']
    - tag_query: ""
      plan: ['*']
      apply: ['team:developers']
```

### Requiring Approvals and Status Checks
You want to enforce that all changes across all repositories in your organization must be approved by at least one member from the SRE team and must pass all status checks before applying.

Specify the following configuration in your `global_overrides`:

```yaml
apply_requirements:
  checks:
    - tag_query: ""
      approved:
        enabled: true
        any_of: ["team:sre"]
        any_of_count: 1
      status_checks:
        enabled: true
```

## Configuration Details
Users can comment `terrateam repo-config` to get an idea of how the configuration was produced. This feature provides detailed information about which files were used to construct the final configuration.
